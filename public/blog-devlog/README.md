# ê¸°ìˆ  ë¸”ë¡œê·¸ ê°œë°œ í”„ë¡œì íŠ¸

## í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ëª…**: ChoiTheGenius ê¸°ìˆ  ë¸”ë¡œê·¸
- **ê¸°ìˆ  ìŠ¤íƒ**: Next.js 15 (App Router), ShadCN, Zustand, Supabase, Milkdown

## ê¸°íš ì˜ë„

### ğŸ” ë¬¸ì œì  (Problem)

ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ VelogëŠ” ê²€ìƒ‰ì´ ë¶ˆí¸í•˜ê³ , ì‘ì„±í•œ ìë£Œê°€ ë§ì•„ì§ˆìˆ˜ë¡ ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§. ì´ì— í•™ìŠµí•œ ë‚´ìš©ì„ ì²´ê³„ì ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³ , ìë£Œ ê°„ì˜ ì—°ê´€ì„±ì„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ìì²´ì ì¸ ê¸°ìˆ  ë¸”ë¡œê·¸ë¥¼ êµ¬ì¶•í•˜ê³ ì í•¨.

### ğŸ’¡ í•´ê²°ì±… (Solution)

> "ì˜ì‹ì ì¸ í›ˆë ¨ì˜ ì£¼ìš” ëª©í‘œ ì¤‘ í•˜ë‚˜ëŠ” ìì‹ ì˜ ìˆ˜í–‰ëŠ¥ë ¥ì„ ì´ëŒì–´ì¤„ íš¨ê³¼ì ì¸ ì‹¬ì  í‘œìƒì„ ê°œë°œí•˜ëŠ” ê²ƒì´ë‹¤"  
> "ì¼ë‹¨ ê²¬ê³ í•œ ì‹¬ì  í‘œìƒì˜ ê¸°ì´ˆë¥¼ ì„¸ìš°ë¡œ ë‚˜ë©´, ê·¸ë¡œë¶€í„° ë”ìš± íš¨ê³¼ì ì¸ ìƒˆë¡œìš´ í‘œìƒì„ ìŠ¤ìŠ¤ë¡œ ë§Œë“¤ì–´ë‚¼ ìˆ˜ê°€ ìˆë‹¤."
>
> â€“ ì•ˆë°ë¥´ìŠ¤ ì—ë¦­ìŠ¨, ã€Š1ë§Œ ì‹œê°„ì˜ ì¬ë°œê²¬ã€‹

1. **ì±… ë‹¨ìœ„ ìë£Œ ê´€ë¦¬**

   - [ìœ„í‚¤ë¶ìŠ¤](https://wikibook.co.kr), [ë”ë¶](https://thebook.io)ì²˜ëŸ¼ ì½˜í…ì¸ ë¥¼ 'ì±…' ë‹¨ìœ„ë¡œ ê´€ë¦¬í•˜ì—¬ ì²´ê³„ì ì¸ í•™ìŠµ ì •ë¦¬

2. **íŠ¸ë¦¬ êµ¬ì¡° ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜**

   - [ìƒí™œì½”ë”©](https://opentutorials.org), [roadmap.sh](https://roadmap.sh/frontend), [Obsidian Graph View](https://obsidian.md)ë¥¼ ì°¸ê³ í•˜ì—¬ ì±…ê³¼ ê²Œì‹œê¸€ì„ íŠ¸ë¦¬ í˜•íƒœë¡œ ì—°ê²°
   - í•™ìŠµ íë¦„ì„ ì§ê´€ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ë©”ì¸ í˜ì´ì§€ êµ¬ì„±

3. **ê°•ë ¥í•œ ë§ˆí¬ë‹¤ìš´ ì—ë””í„°**
   - ê²Œì‹œê¸€ ì‘ì„± ë° ìˆ˜ì •ì€ [Milkdown](https://milkdown.dev)ì„ í™œìš©í•œ WYSIWYG ë§ˆí¬ë‹¤ìš´ ì—ë””í„° ì ìš©
   - [ì›ë…¸íŠ¸](https://www.onenote.com/) ë° [ê¹ƒë¶](https://www.gitbook.com)ì˜ UXë¥¼ ì°¸ê³ í•˜ì—¬ í¸ë¦¬í•œ ë¬¸ì„œ í¸ì§‘ ê²½í—˜ ì œê³µ

## ì£¼ìš” ê¸°ëŠ¥

1. **ë©”ì¸ í˜ì´ì§€**

   - ê²Œì‹œê¸€ì„ 'ì±…' ë‹¨ìœ„ë¡œ ë¬¶ì–´ ê´€ë¦¬
   - 'ì±…'ë“¤ ê°„ì˜ ì—°ê²° ê´€ê³„ë¥¼ í‘œí˜„ (ì§€ì‹ ì§€ë„)

2. **ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜**

   - ëŒ€ë¶„ë¥˜ â†’ ì†Œë¶„ë¥˜ â†’ ê²Œì‹œê¸€ì˜ 3ë‹¨ê³„ êµ¬ì¡° ì ìš©
   - ì†Œë¶„ë¥˜ í´ë¦­ ì‹œ ë™ì ìœ¼ë¡œ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ë„ë¡ êµ¬í˜„
   - í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë˜, cacheë¥¼ ì´ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì„œë²„ìš”ì²­ì´ ì—†ë„ë¡ ê´€ë¦¬

3. **ê²Œì‹œê¸€ ë·°ì–´**

   - ì‚¬ì´ë“œë°”ì—ì„œ ê²Œì‹œê¸€ì„ ì„ íƒí•  ì‹œ ë©”ì¸ ì„¹ì…˜ì´ cachedëœ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¡œ ê²Œì‹œê¸€ì´ ë Œë”ë§ë˜ë„ë¡ êµ¬í˜„
   - íŠ¸ë¦¬ê±°(í† ê¸€ ë²„íŠ¼ ë“±)ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì • ëª¨ë“œë¡œ ì¦‰ì‹œ ì „í™˜
   - ìˆ˜ì • ëª¨ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ê³ , Local Storageë¥¼ ì´ìš©í•œ ì„ì‹œ ì €ì¥ê¸°ëŠ¥ êµ¬í˜„.
   - (ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë³€ê²½ ì‚¬í•­ì´ ì„œë²„ì— ë°˜ì˜ë˜ì§€ ì•Šë„ë¡ í•„í„°ë§)

4. **Next.js + Supabase ì—°ë™**

   - PostgreSQLì„ ë°±ì—”ë“œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‚¬ìš©
   - Supabaseë¥¼ í™œìš©í•œ ì¸ì¦ ë° ë°ì´í„° ê´€ë¦¬

5. **ë°°í¬ ë° ìš´ì˜**
   - Google Cloud Runì„ í™œìš©í•œ ë„ì»¤ë¼ì´ì œì´ì…˜ ë° ë°°í¬ ìë™í™”
   - ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ SSR(ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§) ë° SSG(ì •ì  ì‚¬ì´íŠ¸ ìƒì„±) ì ìš©

## ê°œë°œ ê³„íš

### 1. MVP ê°œë°œ

- ê¸°ë³¸ì ì¸ ë¸”ë¡œê·¸ ë ˆì´ì•„ì›ƒ ë° ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•
- Supabase ì—°ë™ ë° ë°ì´í„° ëª¨ë¸ë§
- ê²Œì‹œê¸€ ì‘ì„± ë° ì¡°íšŒ ê¸°ëŠ¥ êµ¬í˜„

### 2. í•µì‹¬ ê¸°ëŠ¥ ì¶”ê°€

- ì±… ë‹¨ìœ„ ê´€ë¦¬ ë° ì—°ê²° êµ¬ì¡° ì‹œê°í™”
- ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ê³ ë„í™”
- ìºì‹± ë° ìµœì í™” ì‘ì—…

### 3. ë°°í¬ ë° ì„±ëŠ¥ ê°œì„ 

- Google Cloud Run ë°°í¬ ìë™í™”
- SEO ìµœì í™” ë° ì„±ëŠ¥ ê°œì„ 
- ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜ ë° UI/UX ê°œì„ 

## ê¸°ëŒ€ íš¨ê³¼

- ë‹¨ìˆœí•œ ë¸”ë¡œê·¸ê°€ ì•„ë‹Œ, í•™ìŠµ ë° ì§€ì‹ ì •ë¦¬ë¥¼ ìœ„í•œ ì²´ê³„ì ì¸ í”Œë«í¼ ì œê³µ
- ê¸°ìˆ  ìŠ¤íƒ ë° ê°œë°œ ì—­ëŸ‰ì„ í¬íŠ¸í´ë¦¬ì˜¤ì— íš¨ê³¼ì ìœ¼ë¡œ ì–´í•„ ê°€ëŠ¥
- ì‹¤ë¬´ ìˆ˜ì¤€ì˜ Next.js í”„ë¡œì íŠ¸ ê²½í—˜ ì¶•ì 

# ê°œë°œì¼ì§€

## 1ì¼ì°¨ : Sidebar

ì£¼ìš” ê¸°ëŠ¥

- íŒ¨ë„ ë‹¨ìœ„ ê´€ë¦¬ : OneNoteë¥¼ ë²¤ì¹˜ë§ˆí¬í•˜ëŠ” ë§Œí¼ ê° ì¹´í…Œê³ ë¦¬ë¥¼ Panel ë‹¨ìœ„ë¡œ ê´€ë¦¬í•œë‹¤.
- Collapsed : íŒ¨ë„ì„ ì—´ê³  ë‹«ì„ ìˆ˜ ìˆë‹¤. (ì‚¬ì´ë“œë¡œ ì—´ê³  ë‹«ìœ¼ë ¤ë‹¤ê°€ Layout Shiftê°€ ì‹¬í•˜ì—¬ ìƒí•˜ë¡œ ì—´ê³  ë‹«ë„ë¡ êµ¬í˜„í•¨)
- Zustandì™€ SSR : ì‚¬ì´ë“œë°”ì˜ ìƒíƒœë¥¼ Zustandë¡œ ê´€ë¦¬í•˜ë˜, SSRì„ í†µí•´ ì´ˆê¸°ìƒíƒœë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

### Layout

- ê° ê²Œì‹œê¸€ì— ë”°ë¼ ì‚¬ì´ë“œë°”ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ìœ ì§€í•˜ë„ë¡ í´ë” êµ¬ì¡°ë¥¼ ì„¤ì •í•˜ì˜€ë‹¤.
- ê²Œì‹œê¸€ì˜ Idë¥¼ paramsì—ì„œ ì½ì–´ ì‚¬ì´ë“œë°”ì— ë„˜ê²¨ì¤€ë‹¤.
- ~~ì‚¬ì´ë“œë°” ë‚´ë¶€ì— client compoentê°€ ë§ì€ ì , ì‚¬ì´ë“œë°”ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ë³„ë„ë¡œ êµ¬ì„±í•´ì•¼í•˜ëŠ” ì  ë“±ì˜ ì´ìœ ë¡œ React.Suspenseë¡œ ë¶„ë¦¬í•˜ì—¬ ë¡œë”©í•˜ë„ë¡ í•˜ì˜€ë‹¤.~~ _SSRë¡œ ìºì‹±í•˜ê¸° ìœ„í•´ Suspense íƒœê·¸ ì‚­ì œ_

`app/post/[postId]/layout.tsx`

```tsx
import PostSidebar from "@/components/post/sidebar/post-sidebar";
import PostTopBar from "@/components/post/topBar/post-top-bar";
import { ReactNode, Suspense } from "react";

interface TodoLayoutProps {
  params?: Promise<{ postId: string }>;
  children: ReactNode;
}

export default async function TodoLayout({
  params,
  children,
}: TodoLayoutProps) {
  const postId = (await params)?.postId || "";
  return (
    <main className="w-full h-full flex flex-col">
      <PostTopBar />
      <section className="flex flex-row flex-1">
        <div className="w-64 h-full border-r">
          {/* Sidebarë¥¼ suspenseë¡œ ê°ì‹¸ ë¡œë”©ì„ ê¸°ë‹¤ë¦°ë‹¤. Sidebarì˜ ì´ˆê¸°ìƒíƒœë¥¼ ë§Œë“¤ê¸° ìœ„í•´ postIdë¥¼ paramsì—ì„œ ë°›ì•„ ë„˜ê²¨ì¤€ë‹¤. */}
          <Suspense
            fallback={
              <div className="flex justify-center items-center h-full w-full">
                <div className="spinner"></div>
              </div>
            }
          >
            <PostSidebar postId={postId} />
          </Suspense>
        </div>
        <article className="flex-1 overflow-auto">{children}</article>{" "}
      </section>
    </main>
  );
}
```

### Sidebar Store

ì¹´í…Œê³ ë¦¬ë¥¼ 'ëŒ€ë¶„ë¥˜', 'ì†Œë¶„ë¥˜', 'ê²Œì‹œê¸€'ë¡œ ë‚˜ëˆˆë‹¤ê³  í•˜ì˜€ì„ ë•Œ, ì´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ Zustandê°€ í•„ìš”í•˜ë‹¤.  
ì´ë•Œ Zustand ìƒíƒœë¥¼ Global Storeê°€ ì•„ë‹Œ Scoped ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ì•¼ SSRì´ ê°€ëŠ¥í•´ì§„ë‹¤.  
[Setup with Next.js - Zustand](https://zustand.docs.pmnd.rs/guides/nextjs)

`hooks/use-sidebar.tsx`, `providers/sidebar-store-provider.tsx`

ì„œë²„ì—ì„œ ì´ˆê¸° ë Œë”ë§ì‹œì— initialStateë¥¼ ì „ë‹¬í•˜ë„ë¡ í•˜ì˜€ë‹¤.

```tsx
export const createSidebarStore = (initialState?: Partial<SidebarState>) =>
```

### PostSidebar

`PostSidebar`ëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì¸ `SidebarApp` ì»´í¬ë„ŒíŠ¸ì— `SidebarStoreProvider`ë¥¼ ì£¼ì…í•˜ëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸ì´ë‹¤.

PostSidebarë¥¼ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¡œ ì„¤ì •í•¨ìœ¼ë¡œì¨ React.Suspenseë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , SSRì„ í•  ë•Œì— SidebarStoreì— ì´ˆê¸° ìƒíƒœë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ì˜ ì‚¬í•­ì„ ì—¼ë‘ì— ë‘ì—ˆë‹¤.

1. ì£¼ì†Œë¡œë¶€í„° `postId`ë¥¼ ì „ë‹¬ë°›ì•„ ì´ˆê¸° ìƒíƒœë¥¼ ë¡œë”©í•œë‹¤.
2. ì´ˆê¸° ìƒíƒœë¥¼ ì „ë‹¬ë°›ëŠ” Api Callì€ Promise.allë¡œ ë¬¶ì–´ ë¡œë”© ì‹œê°„ì„ ì¤„ì¸ë‹¤.

`components/post/sidebar/post-sidebar.tsx`

```tsx
export default async function PostSidebar({ postId }: PostSidebarProps) {
  const [categories, initialState] = await Promise.all([
    fetchCategories(),
    fetchInitialData(postId),
  ]);

  return (
    <SidebarStoreProvider initialState={initialState}>
      <SidebarApp categories={categories} />
    </SidebarStoreProvider>
  );
}
```

### SidebarPanel

SidebarAppì˜ ì£¼ìš” êµ¬ì„±ìš”ì†Œì¸ íŒ¨ë„ ì»´í¬ë„ŒíŠ¸ì´ë‹¤.  
ì¤‘ë³µëœ ì½”ë“œê°€ ë§ì•„ì ¸ì„œ í•˜ë‚˜ì˜ ì½”ë“œë¡œ í•©ì¹˜ê³ , panel íƒ€ì…ì„ "category", "subcategory", "post"ë¡œ ë‚˜ëˆ„ì–´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ë‹¤.

`components/post/sidebar/panels/sidebar-panel.tsx`

## 2ì¼ì°¨ : Post ìŠ¤í¬ë© ë°©ì•ˆ í…ŒìŠ¤íŠ¸

### Post ë°ì´í„° êµ¬ì¡°

PostëŠ” velogì— ì‘ì„±í–ˆë˜ ê¸€ë“¤ì„ ìŠ¤í¬ë˜í•‘í•  ì˜ˆì •ì´ë‹¤.  
Velogì˜ ìš”ì²­, ì‘ë‹µ ë°ì´í„° êµ¬ì¡°ëŠ” velog-client ê¹ƒí—ˆë¸Œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
[velog-client/src/lib/graphql - github](https://github.com/velopert/velog-client/tree/master/src/lib/graphql)

ë³¸ ì•±ì—ì„œ Postì˜ ë°ì´í„°ëŠ” ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±í•˜ì˜€ë‹¤.  
velogì˜ seriesëŠ” ë³¸ ì•±ì˜ subcategoryì— ëŒ€ì‘ëœë‹¤.

```gql
  post {
    id
    title
    released_at
    updated_at
    tags
    body
    short_description
    thumbnail
    url_slug
    category {
      id
      name
      url_slug
    }
    subcategory {
      id
      name
      url_slug
    }
  }
```

```JS
const post = {
  id: 'af5b4530-b350-11e8-9696-f1fffe8a36f1',
  title: 'ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë¯¸í•™: Redux ë˜ëŠ” MobX ë¥¼ í†µí•œ ìƒíƒœ ê´€ë¦¬',
  released_at: '2018-09-08T10:19:35.556Z',
  updated_at: '2019-07-30T14:19:14.326Z',
  tags: ['redux', 'ìƒíƒœê´€ë¦¬'],
  body: 'ë¦¬ì•¡íŠ¸ ìƒíƒœê³„ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ëŒ€í‘œì ìœ¼ë¡œ Redux ì™€ MobX ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ë‘˜ì˜ íŠ¹ì§•ì„ ë°°ì›Œë³´ê³  ì§ì ‘ ì‚¬ìš©í•˜ë©´ì„œ ì•Œì•„ê°€ë´…ì‹œë‹¤.\n\n## ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•„ìš”ì„±\n\nìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë€ê²Œ, ê³¼ì—° í•„ìš”í• ê¹Œìš”? ë¬´ì¡°ê±´ í•„ìš”í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í•œê°€ì§€ëŠ” í™•ì‹¤í•©ë‹ˆë‹¤. ê·œëª¨ê°€ í° ì•±ì—ì„  ìˆëŠ”ê²Œ, í™•ì‹¤íˆ í¸í•©ë‹ˆë‹¤. ì œê°€ ì¡´ê²½í•˜ëŠ” ê°œë°œìì´ë©´ì„œë„.. ë¦¬ë•ìŠ¤ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì°½ì‹œìì¸ Dan Abramov ëŠ” ë§í•©ë‹ˆë‹¤. ["You might not need Redux"](https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367) [(ë²ˆì—­)](https://medium.com/@Dev_Bono/%EB%8B%B9%EC%8B%A0%EC%97%90%EA%B2%8C-redux%EB%8A%94-%ED%95%84%EC%9A%94-%EC%97%86%EC%9D%84%EC%A7%80%EB%8F%84-%EB%AA%A8%EB%A6%85%EB%8B%88%EB%8B%A4-b88dcd175754)\n\nì‹¤ì œë¡œ, ì—¬ëŸ¬ë¶„ì€ ë¦¬ë•ìŠ¤ ì—†ì´ë„ ì¢‹ì€ ì•±ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìœ¼ë©´, ì´ì „ì—ëŠ” ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬ë¥¼ í•˜ê¸°ì— ì¡°ê¸ˆ ë²ˆê±°ë¡œì› ëŠ”ë° ë¦¬ì•¡íŠ¸ 16.3 ì—ì„œ [Context API](https://react-context.vlpt.us/03.html) ê°€ ë”ìš± ì¢‹ì•„ì§€ë©´ì„œ ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬ ë˜í•œ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n> ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬ë€, ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ë°ì´í„° êµë¥˜, íŠ¹íˆ ë¶€ëª¨-ìì‹ ê´€ê³„ê°€ ì•„ë‹Œ ì»´í¬ë„ŒíŠ¸ë¼ë¦¬ ë°ì´í„° êµë¥˜ë¥¼ í•˜ëŠ”ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ, ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì €ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê²°êµ­ì—ëŠ” ë°°ì›Œë³´ëŠ”ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤. ëª¨ë¥´ê³  ì•ˆ ì“°ëŠ”ê±°ë‘, ì•Œê³  ì•ˆ ì“°ëŠ”ê±°ë‘ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ì£ .',
  short_description:
    'ë¦¬ì•¡íŠ¸ ìƒíƒœê³„ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ëŒ€í‘œì ìœ¼ë¡œ Redux ì™€ MobX ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ë‘˜ì˜ íŠ¹ì§•ì„ ë°°ì›Œë³´ê³  ì§ì ‘ ì‚¬ìš©í•˜ë©´ì„œ ì•Œì•„ê°€ë´…ì‹œë‹¤.\n\nìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•„ìš”ì„±\n\nìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë€ê²Œ, ê³¼ì—° í•„ìš”í• ê¹Œìš”? ë¬´ì¡°ê±´ í•„ìš”í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í•œê°€ì§€ëŠ” í™•ì‹¤í•©ë‹ˆë‹¤. ê·œëª¨ê°€ í° ì•±ì—ì„  ìˆëŠ”ê²Œ, í™•ì‹¤íˆ í¸í•©ë‹ˆë‹¤. ì œê°€ ì¡´ê²½í•˜ëŠ” ê°œë°œìì´ë©´...',
  thumbnail:
    'https://redux.js.org/img/course-callout-mid.svg',
  url_slug: 'redux-or-mobx',
  category: {
      id: 'adbedb50-1b2f-11e9-958c-cdbdd4063c98',
      name: 'í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬',
      url_slug: 'frontend-library',
  },
  subcategory: {
      id: '96ffa520-1b2f-11e9-abae-cb5137f530ec',
      name: 'Redux ë˜ëŠ” MobX ë¥¼ í†µí•œ ìƒíƒœ ê´€ë¦¬',
      url_slug: 'redux-or-mobx',
  },
};
```

ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ì„ ë•Œì˜ ë°ì´í„°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```gql
    category {
      id
      name
      url_slug
      subcategories {
        id
        name
        posts {
          id
          title
          thumbnail
          short_description
          url_slug
          released_at
        }
      }
    }
```

### Post Scraper í”„ë¡œê·¸ë¨ ì‘ì„±

scraper í´ë”ì˜ index.js íŒŒì¼ë¡œ ì‘ì„±í•˜ì˜€ë‹¤.  
í•´ë‹¹ íŒŒì¼ì€ velogì˜ https://v2cdn.velog.io/graphql ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ì—¬ ê²Œì‹œê¸€ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

(ì´ˆê¸°ì— ì›¹ ì‚¬ì´íŠ¸ë¥¼ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ í¬ë¡¤ë§í•˜ëŠ” ë°©ì•ˆìœ¼ë¡œ êµ¬í˜„í•˜ì˜€ìœ¼ë‚˜, ê²Œì‹œê¸€ì˜ ì¼ë¶€ ì •ë³´ê°€ ëˆ„ë½ë˜ì–´ ìˆì–´ graphqlì„ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì•ˆìœ¼ë¡œ ì„ íšŒí•˜ì˜€ìŒ.)

```js
import fs from "fs";
const url_slug = "Jest-Jest-ì‘ì„±ë²•";

async function fetchPost(url_slug) {
  const url = "https://v2cdn.velog.io/graphql";

  const headers = {
    "Content-Type": "application/json",
    Accept: "*/*",
    Origin: "https://velog.io",
    Referer: "https://velog.io/",
  };

  const body = JSON.stringify({
    operationName: "ReadPost",
    query: `query ReadPost($username: String, $url_slug: String) {
      post(username: $username, url_slug: $url_slug) {
        id
        title
        released_at
        updated_at
        tags
...
    }`,
    variables: {
      username: "bluecoolgod80",
      url_slug,
    },
  });

  try {
    const response = await fetch(url, {
      method: "POST",
      headers: headers,
      body: body,
    });

    const data = await response.json();

    fs.writeFileSync(
      "data/" + url_slug + ".json",
      JSON.stringify(data, null, 2)
    );
  } catch (error) {
    console.error("Error fetching post:", error);
  }
}

fetchPost(url_slug);
```

## ë°€í¬ë‹¤ìš´ ì„¤ì¹˜

```
npm install @milkdown/react
npm install @milkdown/kit
npm install @milkdown/theme-nord
```

## 3ì¼ì°¨ : Post ìŠ¤í¬ë© ë° ì´ë¯¸ì§€ ì—…ë¡œë“œ 1ì°¨ êµ¬í˜„

### Post ìŠ¤í¬ë©

`app/api/crawl/[sSlug]/route.ts` í´ë”ì—ì„œ ìˆ˜í–‰í•œë‹¤.

`fetchSeries(url_slug: string)`  
â†’ ì£¼ì–´ì§„ url_slugë¥¼ í†µí•´ velogì˜ ì‹œë¦¬ì¦ˆì™€ í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜. VelogAPIResponseë¼ëŠ” íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.

`getImageUrls(seriesData: VelogAPIResponse)`  
â†’ ì£¼ì–´ì§„ seriesDataì˜ ê²Œì‹œê¸€ë“¤ì—ì„œ imageUrlì„ íŒŒì‹±í•˜ì—¬ ë°°ì—´ë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜

`uploadImageByUrl(url: string)`  
â†’ ì£¼ì–´ì§„ ì´ë¯¸ì§€ URLì„ ê°€ì ¸ì™€ì„œ Supabaseì˜ image ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œí•˜ëŠ” í•¨ìˆ˜.

ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•œ ì´í›„, 'ì‹œë¦¬ì¦ˆ'ì— ëŒ€í•œ ì •ë³´ë¥¼ Supabaseì˜ subcategories í…Œì´ë¸”ì— rowë¡œ ì¶”ê°€í•œë‹¤.

ì´ë•Œ,

1. íŠ¹ìˆ˜ ê¶Œí•œì´ ìˆëŠ” ì‚¬ëŒë§Œ DBì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ 'service_role key'ë¥¼ ì´ìš©í•´ì„œ service_roleë¡œ ì‘ë™í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤. ë¡œê·¸ì¸í•˜ë©´ ë¡œê·¸ì¸ ëœ ì‚¬ìš©ìì˜ roleì„ ë”°ë¼ê°€ê¸°ì— ë¡œê·¸ì•„ì›ƒì„ í•œë²ˆí•˜ê³  ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.

2. subcategoriesì˜ idê°€ uuidë¡œ ìë™ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— velog_idë¼ëŠ” text í˜•íƒœì˜ ì¶”ê°€ ì•„ì´ë””ë¥¼ ë§Œë“¤ì—ˆë‹¤. posts í…Œì´ë¸”ê³¼ ì—°ê²°í•  ë•Œ ìœ ì˜í•´ì•¼ í•¨.

### ì´ë¯¸ì§€ ì—…ë¡œë“œ

`app/api/supabase/upload/route.ts`ì—ì„œ ìˆ˜í–‰í•œë‹¤.

1. í˜„ì¬ëŠ” velog ì£¼ì†Œë§Œ ë°›ì•„ì„œ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ í•˜ì˜€ë‹¤.
2. ë°˜í™˜ê°’ìœ¼ë¡œ public urlì„ ì£¼ëŠ” ìš”ì²­/ì‘ë‹µì„ ê³ ë ¤í•˜ì—¬ ì¶”í›„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ê³¼ POST ì‘ì„± ê¸°ëŠ¥ì„ ì—°ë™í•  ë•Œì— ì´ ì ì— ìœ ì˜í•˜ì—¬ ë¦¬íŒ©í† ë§í•œë‹¤.

## 4ì¼ì°¨ : Subcategory ë° Post ë“±ë¡

DBì˜ public.posts, public.subcategories ì•„ë˜ì˜ ì •ì±…ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ë‹¤.  
ì¡°íšŒ - ëˆ„êµ¬ë‚˜ ê°€ëŠ¥  
ìƒì„± - ë¡œê·¸ì¸ í•œ ì‚¬ìš©ì í˜¹ì€ ì„œë¹„ìŠ¤ ë¡¤
ìˆ˜ì •, ì‚­ì œ - ìì‹ ì´ ìƒì„±í•œ Row í˜¹ì€ ì„œë¹„ìŠ¤ ë¡¤

### í¬ë¡¤ë§í•œ ì„œë¸Œì¹´í…Œê³ ë¦¬ ë“±ë¡

`app/api/crawl/[sSlug]/utils/createCrawledSubcategory.ts`

- supabaseì— ì„œë¸Œì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- velogë¡œ ë¶€í„° crawlëœ series ì •ë³´ë¥¼ ë°›ì•„ì™€ì„œ subcategories í…Œì´ë¸” ì–‘ì‹ì— ë§ê²Œ ë°˜í™˜í•œë‹¤.
- subcategoriesì—ëŠ” velog_id ë¼ëŠ” ë³„ë„ì˜ idë¥¼ ë§Œë“¤ì—ˆë‹¤.
- ìƒì„±ì´ ì™„ë£Œë˜ë©´ ìƒì„±ëœ subcategoryì˜ idë¥¼ ë°˜í™˜í•œë‹¤.

### create post ì„œë²„ì•¡ì…˜

`app/post/actions.tsx`
ì— create post ì•¡ì…˜ì„ ë§Œë“¤ì—ˆë‹¤.
ì¡°íšŒí•  ë•Œì—

```
    .limit(1)
    .single();
```

ë¥¼ ì¿¼ë¦¬ì— ë¶™ì—¬ì£¼ë©´ ë°°ì—´ì´ ì•„ë‹Œ í•˜ë‚˜ë§Œ ë°˜í™˜ëœë‹¤.

### í¬ë¡¤ë§í•œ í¬ìŠ¤íŠ¸ ë“±ë¡

`app/api/crawl/[sSlug]/utils/createCrawledPost.ts`

- supabaseì— postë¥¼ ë“±ë¡í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. postë¥¼ ë“±ë¡í•  ë•Œì—ëŠ” create post ì•¡ì…˜ì„ í˜¸ì¶œí•œë‹¤.
- ì•ì„œ subcategoryë¥¼ ë“±ë¡í•˜ë©´ì„œ ë°›ì€ subcategoryIdë¥¼ ì´ìš©í•˜ì—¬ foreign keyë¡œ subcategory í…Œì´ë¸”ê³¼ ì—°ê²°í•œë‹¤.
- postë¥¼ ë“±ë¡í•˜ê¸° ì „ì— ê²Œì‹œê¸€ bodyë¥¼ ì‚´í”¼ë©° supabaseì— ì €ì¥ëœ ì´ë¯¸ì§€ì˜ ì£¼ì†Œë¡œ ì´ë¯¸ì§€ ì£¼ì†Œë¥¼ parsingí•œë‹¤.

### ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬

`app/api/crawl/[sSlug]/route.ts`

ë‹¤ìŒì˜ ìˆœì„œë¡œ ì‘ë™í•˜ë„ë¡ í•˜ì—¬ êµ¬í˜„ì„ ë§ˆì³¤ë‹¤.

- ì‹œë¦¬ì¦ˆ url_slugë¥¼ í†µí•´ velog apië¥¼ í˜¸ì¶œí•˜ì—¬ í•´ë‹¹ ì‹œë¦¬ì¦ˆì— í¬í•¨ëœ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¨ë‹¤.
- ê²Œì‹œê¸€ ëª©ë¡ì—ì„œ imageë“¤ì˜ urlì„ í˜¸ì¶œí•˜ì—¬ imageë¥¼ supabase storageì— ì—…ë¡œë“œí•œë‹¤.
- ì‹œë¦¬ì¦ˆë¥¼ supabase DBì— subcategoryë¡œ ë“±ë¡í•œë‹¤.
- ê²Œì‹œê¸€ì„ supabase DBì— postë¡œ ë“±ë¡í•˜ê³ , subcategoryIdë¥¼ í†µí•´ subcategoryë¥¼ ì°¸ì¡°í•œë‹¤.

ë‚˜ë¨¸ì§€ êµ¬í˜„í•  ê²ƒë“¤

- ê²Œì‹œê¸€ ì‘ì„±ì‹œì— ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥
- subcategory, category ì—…ë¡œë“œ ë° ìˆ˜ì • ê¸°ëŠ¥
  - ê²Œì‹œê¸€ì— subcategory ì°¸ì¡°í•˜ê¸° ê¸°ëŠ¥
  - subcategoryì— category ì°¸ì¡°í•˜ê¸° ê¸°ëŠ¥

### Trouble Shooting

Service Roleì™€ Authenticatedê°€ ë‘˜ ë‹¤ ì ìš©ë˜ëŠ” ê²½ìš° ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

Imageë¥¼ ì—…ë¡œë“œí•˜ëŠ” route handler(`app/api/supabase/upload/route.ts`)ëŠ” ì„œë¹„ìŠ¤ ë¡¤ì„ ì ìš©í•˜ê³ ,
ë‚˜ë¨¸ì§€ì—ëŠ” ì„œë¹„ìŠ¤ë¡¤ì„ ëª¨ë‘ ì œê±°í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¡œ ê¸€ì„ ì‘ì„±í•˜ë„ë¡ í•˜ì˜€ë‹¤.

## 6ì¼ì°¨ ê³„íš

- template3 ì¼ë‹¨ ë ˆì´ì•„ì›ƒì— ë„£ê³ 
- template3ì— ì¼ë‹¨ ë§ì¶°ì„œ í¬ìŠ¤íŠ¸ ì‘ì„±ê¸°ëŠ¥ ê°œë°œí•˜ê¸°

### MD êµ¬í˜„

- SSRì—ì„œëŠ” ì¡°íšŒë§Œ, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§ˆí¬ë‹¤ìš´ ì—ë””í„° Dynamic import
- "react-markdown"ìœ¼ë¡œ SSR => https://github.com/remarkjs/react-markdown
- "@mdxeditor/editor"ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í¸ì§‘ => https://github.com/mdx-editor/mdx-editor-in-next
- "@mdxeditor/editor"ë¥¼ dynamic-importí•˜ë©´ì„œ ssrì„ falseë¡œ, loadingì„ react-markdown ì»´í¬ë„ŒíŠ¸ë¡œ

[â¡ Markdown Editor êµ¬í˜„ë‚´ìš©ìœ¼ë¡œ ì´ë™í•˜ê¸°](components/markdown/README.md)

## 7ì¼ì°¨ : IndexedDBë¥¼ ì´ìš©í•œ ë¡œì»¬ ìë™ì €ì¥

##### IndexedDB í™œìš© ë°©ì•ˆ

- ë¸Œë¼ìš°ì €ì— ë§ˆìš´íŠ¸ë˜ë©´ indexedDBë¥¼ ì²´í¬
  - -> ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´
    - -> indexedDBì— ì €ì¥ëœ ë°ì´í„°ê°€ ìµœì‹  ë°ì´í„°ë©´ : **"ë¸Œë¼ìš°ì €ì— ì„ì‹œ ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. yyyy.mm.dd hh:mm:ss"** ì•ˆë‚´ (ë°˜ì˜, ì‚­ì œ ì„ íƒ)
- Debounceë¥¼ ì´ìš©í•˜ì—¬ ì…ë ¥ ë‚´ìš©ì„ ì¼ì • ê¸°ê°„ë§ˆë‹¤ indexedDBì— ì €ì¥ (ì…ë ¥ í›„ 30ì´ˆê°€ ì§€ë‚˜ë©´ ì €ì¥)
  - -> ìë™ì €ì¥ í›„ : **"ì‘ì„±ì¤‘ì¸ ë‚´ìš©ì´ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. yyyy.mm.dd hh:mm:ss"**
- ì‚¬ìš©ìê°€ ì„œë²„ì— ë°ì´í„°ë¥¼ ì €ì¥ í›„ : **"ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. yyyy.mm.dd hh:mm:ss"**

##### IndexedDB êµ¬ì¡°

- Database : "markdown-blog"
- strage : "post"-postId
- keys: timestamp, title, body

##### IndexedDB ì»¨íŠ¸ë¡¤ëŸ¬ ìƒíƒœ êµ¬ì¡°

- isUploaded : boolean - ì‚¬ìš©ìê°€ ì´ë²ˆì— ì—…ë¡œë“œë¥¼ í–ˆëŠ”ì§€ í™•ì¸ (ê¸°ë³¸ê°’ false)
- isUploading : boolean - ì„œë²„ì— ì €ì¥ ì¤‘ì¸ì§€ (ê¸°ë³¸ê°’ false)
- isAutoSaved : boolean - ì´ë²ˆ ì„¸ì…˜ì— ìë™ì €ì¥ì´ ëœ ì ì´ ìˆëŠ”ì§€ í™•ì¸ (ê¸°ë³¸ê°’ false)
- isAutoSaving : boolean - IndexedDBì— ìë™ì €ì¥ ì¤‘ì¸ì§€ (ê¸°ë³¸ê°’ false)
- recentIndexedDbData : { postId : string; data : { timestamp, title, body };} | null - indexedDbì— ì €ì¥ëœ ìµœì‹  ë°ì´í„° (ê¸°ë³¸ê°’ null)

### AutosaveStore

ì´ˆê¸°ìƒíƒœ

```tsx
{
  isUploaded: false,
  isUploading: false,
  isAutoSaved: false,
  isAutoSaving: false,
  recentAutoSavedData: null,
}
```

#### AutosaveState ìƒíƒœ ë³€í™”ì— ë”°ë¥¸ ë©”ì‹œì§€

1. **ìµœì´ˆ ë§ˆìš´íŠ¸ ì‹œ í˜¹ì€ ì„ì‹œì €ì¥ëœ ê²Œì‹œê¸€ì´ ì—†ì„ ì‹œ**  
   **AutosaveIndicator:** (ë©”ì‹œì§€ ì—†ìŒ)

```tsx
{
  isUploaded: false,
  isUploading: false,
  isAutoSaved: false,
  isAutoSaving: false,
  recentAutoSavedData: null,
}
```

- **ì„¤ëª…**:
  - **ìµœì´ˆ ë§ˆìš´íŠ¸ ì‹œ** ì•„ë¬´ ë°ì´í„°ë„ ì—†ëŠ” ìƒíƒœ.
  - IndexedDBì— ì €ì¥ëœ ì„ì‹œ ë°ì´í„°ê°€ ì—†ê³ , ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë„ ì—†ì„ ë•Œ.

---

2. **ì„œë²„ì˜ ë°ì´í„°ê°€ ìµœì‹  ë°ì´í„°ì¼ ì‹œ**  
   **AutosaveIndicator:** (ë©”ì‹œì§€ ì—†ìŒ)

```tsx
{
  isUploaded: false,
  isUploading: false,
  isAutoSaved: false,
  isAutoSaving: false,
  recentAutoSavedData: data,
}
```

- **ì„¤ëª…**:
  - IndexedDBì— ì €ì¥ëœ ë°ì´í„°ê°€ ìˆì§€ë§Œ, **ì„œë²„ì˜ ë°ì´í„°ì™€ ë™ì¼**í•œ ìƒíƒœ.
  - ì¦‰, **ìë™ ì €ì¥ì´ ì‹¤í–‰ë  í•„ìš” ì—†ìŒ**.

---

3. **ê²Œì‹œê¸€ì„ ìˆ˜ì •í•´ì„œ ìë™ ì €ì¥ ì‹¤í–‰ ì¤‘**  
   **AutosaveIndicator:** `"ìë™ ì €ì¥ ì¤‘ ì…ë‹ˆë‹¤."`

```tsx
{
  isUploaded: false,
  isUploading: false,
  isAutoSaved: false,  // ì•„ì§ ì €ì¥ë˜ì§€ ì•ŠìŒ
  isAutoSaving: true,  // ìë™ ì €ì¥ ì‹¤í–‰ ì¤‘
  recentAutoSavedData: data,
}
```

- **ì„¤ëª…**:
  - ì‚¬ìš©ìê°€ ê²Œì‹œê¸€ì„ ìˆ˜ì •í–ˆê³ , **ë””ë°”ìš´ìŠ¤ í›„ ìë™ ì €ì¥ì´ ì‹¤í–‰ë¨**.

---

4. **ìë™ ì €ì¥ì´ ì™„ë£Œëœ ê²½ìš°**  
   **AutosaveIndicator:** `"ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."`

```tsx
{
  isUploaded: false,
  isUploading: false,
  isAutoSaved: true,  // ìë™ ì €ì¥ ì™„ë£Œë¨
  isAutoSaving: false, // ìë™ ì €ì¥ ì§„í–‰ ì¤‘ ì•„ë‹˜
  recentAutoSavedData: data,
}
```

- **ì„¤ëª…**:
  - **ìë™ ì €ì¥ì´ ì™„ë£Œë¨**.
  - **IndexedDBì— ì €ì¥ë¨**.
  - í•˜ì§€ë§Œ **ì•„ì§ ì„œë²„ì—ëŠ” ì—…ë¡œë“œë˜ì§€ ì•ŠìŒ**.

---

5. **ì„œë²„ì— ì—…ë¡œë“œ ì¤‘ì¸ ê²½ìš°**  
   **AutosaveIndicator:** `"ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤."`

```tsx
{
  isUploaded: false,
  isUploading: true,
  isAutoSaved: true,  // ìë™ ì €ì¥ëœ ìƒíƒœì—ì„œ ì—…ë¡œë“œ
  isAutoSaving: false,
  recentAutoSavedData: data, // ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„°
}
```

- **ì„¤ëª…**:
  - ì„œë²„ë¡œ **ìµœì‹  ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ì¤‘**.
  - ì´ë•Œ `isAutoSaved: true`ì¸ ìƒíƒœì—ì„œ ì—…ë¡œë“œê°€ ì§„í–‰ë¨.

---

6. **ì„œë²„ì— ì—…ë¡œë“œ ì™„ë£Œëœ ê²½ìš°**  
   **AutosaveIndicator:** `"ì—…ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤."`

```tsx
{
  isUploaded: true,
  isUploading: false,
  isAutoSaved: false,  // ì„œë²„ì— ì €ì¥ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ˆê¸°í™”
  isAutoSaving: false,
  recentAutoSavedData: null,  // ì—…ë¡œë“œ í›„ IndexedDBì—ì„œ ë°ì´í„° ì‚­ì œ
}
```

- **ì„¤ëª…**:
  - **ì„œë²„ ì—…ë¡œë“œ ì™„ë£Œ í›„ IndexedDB ë°ì´í„°ë¥¼ ì •ë¦¬**.
  - ë” ì´ìƒ **ìë™ ì €ì¥ëœ ë°ì´í„°ë¥¼ ìœ ì§€í•  í•„ìš” ì—†ìŒ**.
  - ì´í›„ ì‚¬ìš©ìê°€ ë‹¤ì‹œ ìˆ˜ì •í•˜ë©´ `isUploaded: true â†’ false`, `isAutoSaved: false â†’ true`ë¡œ ë³€ê²½ë¨.

---

### useIndexedDB

`hooks/use-indexeddb.tsx`

- **`addData(storeName: string, data: any): Promise<IDBValidKey>`**  
  â†’ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³ , ì¶”ê°€ëœ ë°ì´í„°ì˜ `id`(key)ë¥¼ ë°˜í™˜í•¨.

- **`getData(storeName: string, id: IDBValidKey): Promise<any | undefined>`**  
  â†’ ì£¼ì–´ì§„ `id`ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜, ì—†ìœ¼ë©´ `undefined` ë°˜í™˜.

- **`getAllData(storeName: string): Promise<any[]>`**  
  â†’ IndexedDBì˜ í•´ë‹¹ Object Storeì— ìˆëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜.

- **`deleteData(storeName: string, id: IDBValidKey): Promise<void>`**  
  â†’ íŠ¹ì • `id` ê°’ì„ ê°€ì§„ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³ , ë°˜í™˜ê°’ ì—†ìŒ.

- **`clearStore(storeName: string): Promise<void>`**  
  â†’ IndexedDBì˜ í•´ë‹¹ Object Storeì— ìˆëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³ , ë°˜í™˜ê°’ ì—†ìŒ.

- **`getDataByOpenCursor(storeName: string, callback: (data: any) => void): Promise<void>`**  
  â†’ `openCursor()`ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ìˆœíšŒí•˜ë©° `callback` í•¨ìˆ˜ë¡œ ê° ë°ì´í„°ë¥¼ ì²˜ë¦¬, ë°˜í™˜ê°’ ì—†ìŒ.

6ê°œì˜ í•¨ìˆ˜ë¥¼ ì§€ë‹Œ í›…ì„ ë§Œë“¤ì—ˆë‹¤.  
ì•„ì§ IndexedDBì— ìµìˆ™í•˜ì§€ ì•Šì•„ì„œ JSDocì„ ê¼¼ê¼¼í•˜ê²Œ ì‘ì„±í–ˆë‹¤.

### useDebounce, useAutosaveHandler

`hooks/use-debounce.tsx` : ë””ë°”ìš´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í›…
`hooks/use-autosave-handler.tsx` : body, titleì„ ì „ë‹¬ë°›ì•„ useDebounceë¥¼ ì‹¤í–‰í•˜ê³ , debouncedë˜ë©´ autosaveStoreì˜ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤.

### ì»´í¬ë„ŒíŠ¸

- `post-controller/autosave/autosave-indicator.tsx`

  - ìë™ ì €ì¥ ìƒíƒœë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
  - "ìë™ ì €ì¥ ì¤‘", "ìë™ ì €ì¥ ì™„ë£Œ" ë“±ì˜ ë©”ì‹œì§€ í‘œì‹œ

- `autosave/autosave-loader.tsx`

  - `dynamic import`ë¥¼ ì‚¬ìš©í•˜ì—¬ `AutoSaveWrapper`ë¥¼ ë¹„ë™ê¸° ë¡œë“œ
  - SSRì„ ë¹„í™œì„±í™”í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •

- `components/post/main/post-controller/autosave/autosave-wrapper.tsx`
  - ë§ˆìš´íŠ¸ ì‹œ IndexedDBì—ì„œ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ìë™ ì €ì¥ ìƒíƒœë¥¼ ë³µì›
  - autosaveStoreì˜ ìƒíƒœì— ë”°ë¼ `useIndexedDB`ë¥¼ ì´ìš©í•´ ìë™ ì €ì¥ëœ ë°ì´í„°ë¥¼ IndexedDBì— ì €ì¥ ë° ë¡œë“œ

## 8ì¼ì°¨ : ê²Œì‹œê¸€ ìë™ì €ì¥ ë° ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸

### Trial And Error

ì‹œí–‰ì°©ì˜¤ë¥¼ ë„ˆë¬´ ë§ì´ ê²ªì–´ì„œ ìë™ì €ì¥ ë°˜ì˜í•˜ë©´ì„œ ê²ªì€ ì´ìŠˆë§Œ ì¼ë‹¨ì •ë¦¬

- **MDXEditor**

  - MDXEditorê°€ mountedë  ë•Œì—ëŠ” onChangeì˜ initialMarkdownNormalizeê°€ trueë¡œ ë°˜í™˜ëœë‹¤. ì¦‰ initialMarkdownNormalizeê°€ falseì¼ ë•Œì—ë§Œ ìƒíƒœë³€ê²½ í•¨ìˆ˜ë¥¼ ë„£ì–´ì•¼ í•œë‹¤. setBodyë¥¼ falseì¼ ë•Œ ì‘ë™í•˜ë„ë¡ í–ˆë‹¤.
  - ì¶”ê°€ì ìœ¼ë¡œ MDXEditorì— ì§ì ‘ ìƒíƒœë¥¼ ì£¼ì…í•  ë•Œì—ëŠ” useRefë¡œ MDXEditorê°€ ê°€ì§„ ë©”ì„œë“œë“¤ì„ ë°˜í™˜ë°›ì•„ ì‚¬ìš©í•˜ë„ë¡ ë˜ì–´ ìˆë‹¤. mdxEditorRefë¥¼ ì§€ì •í•´ì£¼ì—ˆë‹¤.

- **MdxEditorWrapper**

  - ì´ˆê¸°ì— ê°€ë§Œíˆë§Œ ìˆì–´ë„ ê³„ì† ìë™ì €ì¥ì´ ì‹¤í–‰ë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°, MDXEditorì˜ onChageê°€ í•œ ë²ˆì´ë¼ë„ ì‹¤í–‰ëì—ˆëŠ”ì§€ë¥¼ ì²´í¬í•˜ëŠ” í”Œë˜ê·¸(hasChanged)ë¥¼ ë„£ì–´ë‘ì—ˆë‹¤. ë¬¸ìì—´ ë¹„êµë„ ë„£ì—ˆì—ˆëŠ”ë°, ë¬¸ìì—´ ë¹„êµëŠ” ì œê±°í–ˆë‹¤. (ìë™ ì €ì¥ëœ ë‚´ìš©ê³¼ ë¬¸ìì—´ì´ ë‹¤ë¥¸ ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì´ë¼ ì‹¤ì‚¬ìš©ì—ì„œ ì°¨ì´ê°€ ì—†ì—ˆìŒ.)

- **zustand**

  - SSRì„ ìœ„í•´ Providerë¡œ ìƒíƒœë¥¼ ì£¼ì…í•˜ëŠ” instance-based stateë¥¼ ì‚¬ìš©ì¤‘ì´ì—ˆëŠ”ë°, ë©ì²­í•˜ê²Œ AutuSaveProvierë¥¼ ì—¬ëŸ¬ê°œ ì„ ì–¸í–ˆë‹¤. ì´ëŸ° ê²½ìš°ì— ì„œë¡œ ìƒíƒœê³µìœ ê°€ ì•ˆëœë‹¤.
  - zustand ìƒíƒœë¥¼ ê°ì²´ í˜•íƒœë¡œ ë°˜í™˜í•˜ëŠ” ê³¼ì •ì—ì„œ ë¬´í•œë Œë”ë§ì´ ë°œìƒí•˜ì˜€ë‹¤. useShallowë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì”Œìš°ëŠ”ê²Œ ì¢‹ë‹¤ëŠ” ì‚¬ìš©ìë“¤ì˜ ì˜ê²¬ì´ ë§ì•„ì„œ useShallowë¥¼ ì ìš©í–ˆë”ë‹ˆ ë¬¸ì œê°€ ì‚¬ë¼ì¡Œë‹¤.

- **use-indexeddb.tsx**
  - 'saved_at'ì´ë¼ëŠ” ì¹¼ëŸ¼ì„ ë§Œë“ ë‹¤ê³  ê°€ì •í•˜ê³  indexedDBë¥¼ ë¨¼ì € ì„¤ê³„í–ˆì—ˆëŠ”ë°, zustandì—ì„œëŠ” 'timestamp'ë¼ëŠ” í‚¤ë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•´ë²„ë ¸ë‹¤. 'timestamp' ì¹¼ëŸ¼ì„ ë§Œë“¤ë„ë¡ ëŒ€ì²´í•˜ì˜€ë‹¤.
  - í•œí¸ openCursorë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ì¸ë±ìŠ¤ë¥¼ ë¨¼ì € ìƒì„±í•´ì•¼ í•œë‹¤!'timestamp'ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.

ê·¸ ë°–ì— í˜„ì¬ ì´ˆê¸°ìƒíƒœê°’, ì„ì‹œì €ì¥ëœ ê°’, ìƒˆë¡œì‘ì„±í•œ ê°’ì„ ë³„ë„ë¡œ êµ¬ë¶„í•˜ì§€ ì•Šê³  recentAutoSavedDataë¼ëŠ” í•˜ë‚˜ì˜ ìƒíƒœê°’ìœ¼ë¡œ ì¡°ì‘í•˜ê³  ìˆë‹¤. ì´ ì ì— ìœ ì˜í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•  ê²ƒ.

### Refactoring

IndexedDBì˜ êµ¬ì¡°ë¥¼ Myblog-postId-{title, body}ì—ì„œ MyBlog-MyStore-{postId, title, body} ë¡œ ë³€ê²½í•˜ë„ë¡ ë¦¬íŒ©í† ë§.  
IndexedDBì˜ storeë¥¼ í•˜ë‚˜ë¡œ í†µí•©í•´ì•¼ ì„ì‹œì €ì¥ëœ ë°ì´í„° ëª©ë¡ì„ í•œë²ˆì— ë¶ˆëŸ¬ì˜¤ê±°ë‚˜, í•´ë‹¹ ê²Œì‹œê¸€ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì„ ì „ë¶€ ì‚­ì œí•˜ê¸°ì— ì¢‹ë‹¤. (storeëŠ” ì‚­ì œê°€ ì•ˆëœë‹¤... ã… ã… )
autosave-wrapperì™€ use-indexeddbë¥¼ ì´ì— ë§ê²Œ ìˆ˜ì •í•˜ì˜€ê³ , ê·¸ ê³¼ì •ì—ì„œ indexedDBì˜ ì¬ì‚¬ìš©ì„±ì´ ë§ì´ ë–¨ì–´ì¡Œë‹¤.

## 9ì¼ì°¨ : ìë™ì €ì¥ ê²Œì‹œê¸€ ë°˜ì˜, AI ìš”ì•½ API

### ìë™ì €ì¥ê²Œì‹œê¸€ ë°˜ì˜í•˜ê¸° ê¸°ëŠ¥

- dayjs ì„¤ì¹˜í•˜ì˜€ìŒ! lib/date.ts
- ìë™ì €ì¥ ê²Œì‹œê¸€ ë°˜ì˜ì„ ìœ„í•´ isLocalDBChecked ì¶”ê°€í•˜ì˜€ìŒ.

ìë™ì €ì¥ indicator ì „ì²´ì ì¸ ui ê°œì„  í•„ìš”.

### AI ìš”ì•½

#### ai_summaries í…Œì´ë¸” ìƒì„±

1. SUPABASEì— pgvectorì„¤ì¹˜ `CREATE EXTENSION IF NOT EXISTS vector;`
2. ai_summaries í…Œì´ë¸” ì¶”ê°€

```sql
CREATE TABLE ai_summaries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    post_id UUID NULL REFERENCES posts(id) ON DELETE SET NULL,
    user_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
    summary TEXT NOT NULL,
    vector VECTOR(1536),
    created_at TIMESTAMP DEFAULT now(),
    updated_at TIMESTAMP DEFAULT now(),
    deleted_at TIMESTAMP DEFAULT NULL
);
```

3. RLS í™œì„±í™”, REFERENCESì— cacades ë“±ì„ ì„¤ì •í•˜ê³  í…Œì´ë¸” ìƒì„± ì™„ë£Œ.
4. RLS ì ìš©

```sql
-- public.posts í…Œì´ë¸”ì— RLS ì •ì±… ì ìš©
create policy "Enable delete for users based on user_id"
on "public".ai_summaries
to public
using (
  (( SELECT auth.uid() AS uid) = user_id)
);

create policy "Enable insert for authenticated users only"
on "public".ai_summaries
to authenticated
with check (
  true
);

create policy "Enable update for users based on user_id"
on "public".ai_summaries
to public
using (
  (( SELECT auth.uid() AS uid) = user_id)
)
with check (
  (( SELECT auth.uid() AS uid) = user_id)
);

create policy "Enable read access for all users"
on "public".ai_summaries
to public
using (
  true
);
```

#### chatgpt api ì‘ì„±í•˜ê¸°

1. openai api keys ìƒì„± - [https://platform.openai.com/settings/organization/api-keys](https://platform.openai.com/settings/organization/api-keys)
2. .envì— `OPENAI_API_KEY=sk-proj****`ë¡œ ì €ì¥
3. app/api/summary/route.ts ì— chatgpt apië¥¼ í”„ë¡¬í”„íŠ¸ì™€ ì˜ˆì‹œë¥¼ í†µí•´ ì‘ì„±

#### ì„œë²„ì— ìš”ì•…ëœ ì •ë³´ë¥¼ ì‘ì„±í•˜ëŠ” server action ì‘ì„±

`app/post/actions.tsx/createAISummary`
ì´ë•Œ `VECTOR(1536)`ì€ `number[]` íƒ€ì…ì´ì–´ì•¼ í•˜ëŠ”ë° supabase:genìœ¼ë¡œëŠ” ì´ê²ƒì´ ë°˜ì˜ì´ ì•ˆë˜ì–´ì„œ omitìœ¼ë¡œ ë®ì–´ ì”Œì›Œì¤¬ë‹¤.

#### ê¸°ì¡´ crawl ì½”ë“œ ìˆ˜ì •

`app/api/crawl/[sSlug]/utils/createCrawledAISummary.ts`ë¥¼ í†µí•´ open ai apië¥¼ í˜¸ì¶œí•˜ì—¬ ìš”ì•½ì •ë³´ë¥¼ ë°›ê³ ,  
ìš”ì•½ëœ ì •ë³´ë¥¼ serverì— ì—…ë¡œë“œí•˜ë„ë¡ í•˜ì˜€ë‹¤.

í•´ë‹¹ createCrawledAISummary í•¨ìˆ˜ëŠ” `app/api/crawl/[sSlug]/utils/createCrawledPost.ts`ì—ì„œ promise.allë¡œ ê°ì‹¸ ì‹¤í–‰ë˜ë„ë¡ í•˜ì˜€ë‹¤.
